"use strict";

/* global wpRigScreenReaderText */

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
var KEYMAP = {
  TAB: 9
};

if ('loading' === document.readyState) {
  // The DOM has not yet been loaded.
  document.addEventListener('DOMContentLoaded', initNavigation);
} else {
  // The DOM has already been loaded.
  initNavigation();
} // Initiate the menus when the DOM loads.


function initNavigation() {
  initNavToggleSubmenus();
  initNavToggleSmall();
}
/**
 * Initiate the script to process all
 * navigation menus with submenu toggle enabled.
 */


function initNavToggleSubmenus() {
  var navTOGGLE = document.querySelectorAll('.nav--toggle-sub'); // No point if no navs.

  if (!navTOGGLE.length) {
    return;
  }

  for (var i = 0; i < navTOGGLE.length; i++) {
    initEachNavToggleSubmenu(navTOGGLE[i]);
  }
}
/**
 * Initiate the script to process submenu
 * navigation toggle for a specific navigation menu.
 * @param {Object} nav Navigation element.
 */


function initEachNavToggleSubmenu(nav) {
  // Get the submenus.
  var SUBMENUS = nav.querySelectorAll('.menu ul'); // No point if no submenus.

  if (!SUBMENUS.length) {
    return;
  } // Create the dropdown button.


  var dropdownButton = getDropdownButton();

  for (var i = 0; i < SUBMENUS.length; i++) {
    var parentMenuItem = SUBMENUS[i].parentNode;
    var dropdown = parentMenuItem.querySelector('.dropdown'); // If no dropdown, create one.

    if (!dropdown) {
      // Create dropdown.
      dropdown = document.createElement('span');
      dropdown.classList.add('dropdown');
      var dropdownSymbol = document.createElement('i');
      dropdownSymbol.classList.add('dropdown-symbol');
      dropdown.appendChild(dropdownSymbol); // Add before submenu.

      SUBMENUS[i].parentNode.insertBefore(dropdown, SUBMENUS[i]);
    } // Convert dropdown to button make one for parent item and one for first child in submenu


    var thisDropdownButton = dropdownButton.cloneNode(true);
    var childDropdownButton = dropdownButton.cloneNode(true); // Copy contents of dropdown into button.

    thisDropdownButton.innerHTML = dropdown.innerHTML;
    childDropdownButton.innerHTML = dropdown.innerHTML; // Replace dropdown with toggle button.

    dropdown.parentNode.replaceChild(thisDropdownButton, dropdown); //firstSubItem.appendChild( childDropdownButton );
    // Toggle the submenu when we click the dropdown button.

    thisDropdownButton.addEventListener('click', function (e) {
      toggleSubMenu(e.target.parentNode);
    }); // Toggle the submenu when we click the dropdown button.

    childDropdownButton.addEventListener('click', function (e) {
      toggleSubMenu(findAncestor(e.target, '.menu-item--has-toggle'));
    }); // // Clean up the toggle if a mouse takes over from keyboard.
    // parentMenuItem.addEventListener( 'mouseleave', ( e ) => {
    // 	toggleSubMenu( e.target, false );
    // } );
    // When we focus on a menu link, make sure all siblings are closed.

    parentMenuItem.querySelector('a').addEventListener('focus', function (e) {
      var parentMenuItemsToggled = e.target.parentNode.parentNode.querySelectorAll('li.menu-item--toggled-on');

      for (var j = 0; j < parentMenuItemsToggled.length; j++) {
        toggleSubMenu(parentMenuItemsToggled[j], false);
      }
    }); // Handle keyboard accessibility for traversing menu.

    SUBMENUS[i].addEventListener('keydown', function (e) {
      // These specific selectors help us only select items that are visible.
      var focusSelector = 'ul.toggle-show > li > a, ul.toggle-show > li > button';

      if (KEYMAP.TAB === e.keyCode) {
        if (e.shiftKey) {
          // Means we're tabbing out of the beginning of the submenu.
          if (isfirstFocusableElement(e.target, document.activeElement, focusSelector)) {
            toggleSubMenu(e.target.parentNode, false);
          } // Means we're tabbing out of the end of the submenu.

        } else if (islastFocusableElement(e.target, document.activeElement, focusSelector)) {
          toggleSubMenu(e.target.parentNode, false);
        }
      }
    });
    SUBMENUS[i].parentNode.classList.add('menu-item--has-toggle');
  }
}
/**
 * Initiate the script to process all
 * navigation menus with small toggle enabled.
 */


function initNavToggleSmall() {
  var navTOGGLE = document.querySelectorAll('.nav--toggle-small'); // No point if no navs.

  if (!navTOGGLE.length) {
    return;
  }

  for (var i = 0; i < navTOGGLE.length; i++) {
    initEachNavToggleSmall(navTOGGLE[i]);
  }
}
/**
 * Initiate the script to process small
 * navigation toggle for a specific navigation menu.
 * @param {Object} nav Navigation element.
 */


function initEachNavToggleSmall(nav) {
  var menuTOGGLE = nav.querySelector('.header-toggle'); // Return early if MENUTOGGLE is missing.

  if (!menuTOGGLE) {
    return;
  } // Add an initial values for the attribute.


  menuTOGGLE.setAttribute('aria-expanded', 'false');
  menuTOGGLE.addEventListener('click', function (e) {
    /** Toggle search / menus when one is open and clicking on the other */
    var toggleOff = e.currentTarget.getAttribute('data-toggleoff');
    var toggleOffBtn = document.getElementById(toggleOff);

    if (toggleOffBtn && 'true' === toggleOffBtn.getAttribute('aria-expanded')) {
      document.getElementById(toggleOff).click();
    }

    nav.classList.toggle('nav--toggled-on'); //set the nav height so it doesnt fluctuate when we show the sub-menu on mobile
    //set the top according to the header height

    if (window.innerWidth < 1024) {
      var primary = document.getElementById('primary-menu');
      var overlay = document.getElementById('nav-overlay');
      var header = document.getElementById('masthead');

      if (!primary.classList.contains('fixed-height')) {
        var pHeight = primary.offsetHeight;
        primary.style.height = pHeight + 'px';
        primary.classList.add('fixed-height');
      }

      if (document.body.classList.contains('admin-bar')) {
        var adminbar = document.getElementById('wpadminbar');
        overlay.style.top = header.offsetHeight + adminbar.offsetHeight + 'px';
      } else {
        overlay.style.top = header.offsetHeight + 'px';
      }

      primary.style.top = header.offsetHeight + 'px';
    } //should not scroll when  nav is open (mobile only but that is handled with css)


    if (nav.classList.contains('nav--toggled-on') && nav.classList.contains('main-navigation')) {
      //document.body.classList.add( 'overflow-hidden' );
      document.documentElement.classList.add('overflow-hidden');
    } else {
      //document.body.classList.remove( 'overflow-hidden' );
      document.documentElement.classList.remove('overflow-hidden');
    }

    e.currentTarget.setAttribute('aria-expanded', 'false' === e.currentTarget.getAttribute('aria-expanded') ? 'true' : 'false');
  }, false);
}
/**
 * Toggle submenus open and closed, and tell screen readers what's going on.
 * @param {Object} parentMenuItem Parent menu element.
 * @param {boolean} forceToggle Force the menu toggle.
 * @return {void}
 */


function toggleSubMenu(parentMenuItem, forceToggle) {
  var toggleButton = parentMenuItem.querySelector('.dropdown-toggle'),
      subMenu = parentMenuItem.querySelector('ul'),
      mainParentMenu = parentMenuItem.closest('.nav--toggle-small');
  var parentMenuItemToggled = parentMenuItem.classList.contains('menu-item--toggled-on'); // Will be true if we want to force the toggle on, false if force toggle close.

  if (undefined !== forceToggle && 'boolean' === typeof forceToggle) {
    parentMenuItemToggled = !forceToggle;
  } // Toggle aria-expanded status.


  toggleButton.setAttribute('aria-expanded', (!parentMenuItemToggled).toString());
  /*
   * Steps to handle during toggle:
   * - Let the parent menu item know we're toggled on/off.
   * - Toggle the ARIA label to let screen readers know will expand or collapse.
   */

  if (parentMenuItemToggled) {
    // Toggle "off" the submenu.
    parentMenuItem.classList.remove('menu-item--toggled-on');
    subMenu.classList.remove('toggle-show');
    toggleButton.setAttribute('aria-label', wpRigScreenReaderText.expand);
    mainParentMenu.classList.remove('subnav--toggled-on'); // Make sure all children are closed.

    var subMenuItemsToggled = parentMenuItem.querySelectorAll('.menu-item--toggled-on');

    for (var i = 0; i < subMenuItemsToggled.length; i++) {
      toggleSubMenu(subMenuItemsToggled[i], false);
    }
  } else {
    // Make sure siblings are closed.
    var parentMenuItemsToggled = parentMenuItem.parentNode.querySelectorAll('li.menu-item--toggled-on');

    for (var _i = 0; _i < parentMenuItemsToggled.length; _i++) {
      toggleSubMenu(parentMenuItemsToggled[_i], false);
    } // Toggle "on" the submenu.


    parentMenuItem.classList.add('menu-item--toggled-on');
    mainParentMenu.classList.add('subnav--toggled-on');
    subMenu.classList.add('toggle-show');
    toggleButton.setAttribute('aria-label', wpRigScreenReaderText.collapse);
  }
}
/**
 * Returns the dropdown button
 * element needed for the menu.
 * @return {Object} drop-down button element
 */


function getDropdownButton() {
  var dropdownButton = document.createElement('button');
  dropdownButton.classList.add('dropdown-toggle');
  dropdownButton.setAttribute('aria-expanded', 'false');
  dropdownButton.setAttribute('aria-label', wpRigScreenReaderText.expand);
  return dropdownButton;
}
/**
 * Returns true if element is the
 * first focusable element in the container.
 * @param {Object} container
 * @param {Object} element
 * @param {string} focusSelector
 * @return {boolean} whether or not the element is the first focusable element in the container
 */


function isfirstFocusableElement(container, element, focusSelector) {
  var focusableElements = container.querySelectorAll(focusSelector);

  if (0 < focusableElements.length) {
    return element === focusableElements[0];
  }

  return false;
}
/**
 * Returns true if element is the
 * last focusable element in the container.
 * @param {Object} container
 * @param {Object} element
 * @param {string} focusSelector
 * @return {boolean} whether or not the element is the last focusable element in the container
 */


function islastFocusableElement(container, element, focusSelector) {
  var focusableElements = container.querySelectorAll(focusSelector);

  if (0 < focusableElements.length) {
    return element === focusableElements[focusableElements.length - 1];
  }

  return false;
}
/**
 *  Return ancestor with class
 *  For IE 11 (does not support closest d)
 * @param {Object} el
 * @param {string} sel
 * @return {Object} matching element
 */


function findAncestor(el, sel) {
  while ((el = el.parentElement) && !(el.matches || el.matchesSelector).call(el, sel)) {}

  return el;
}
/**
 * Remove height on menu when window size changes
 */


window.addEventListener('resize', function () {
  var primary = document.getElementById('primary-menu');
  primary.classList.remove('fixed-height');
  primary.style.removeProperty('height');
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5hdmlnYXRpb24uanMiXSwibmFtZXMiOlsiS0VZTUFQIiwiVEFCIiwiZG9jdW1lbnQiLCJyZWFkeVN0YXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImluaXROYXZpZ2F0aW9uIiwiaW5pdE5hdlRvZ2dsZVN1Ym1lbnVzIiwiaW5pdE5hdlRvZ2dsZVNtYWxsIiwibmF2VE9HR0xFIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImkiLCJpbml0RWFjaE5hdlRvZ2dsZVN1Ym1lbnUiLCJuYXYiLCJTVUJNRU5VUyIsImRyb3Bkb3duQnV0dG9uIiwiZ2V0RHJvcGRvd25CdXR0b24iLCJwYXJlbnRNZW51SXRlbSIsInBhcmVudE5vZGUiLCJkcm9wZG93biIsInF1ZXJ5U2VsZWN0b3IiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJvcGRvd25TeW1ib2wiLCJhcHBlbmRDaGlsZCIsImluc2VydEJlZm9yZSIsInRoaXNEcm9wZG93bkJ1dHRvbiIsImNsb25lTm9kZSIsImNoaWxkRHJvcGRvd25CdXR0b24iLCJpbm5lckhUTUwiLCJyZXBsYWNlQ2hpbGQiLCJlIiwidG9nZ2xlU3ViTWVudSIsInRhcmdldCIsImZpbmRBbmNlc3RvciIsInBhcmVudE1lbnVJdGVtc1RvZ2dsZWQiLCJqIiwiZm9jdXNTZWxlY3RvciIsImtleUNvZGUiLCJzaGlmdEtleSIsImlzZmlyc3RGb2N1c2FibGVFbGVtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzbGFzdEZvY3VzYWJsZUVsZW1lbnQiLCJpbml0RWFjaE5hdlRvZ2dsZVNtYWxsIiwibWVudVRPR0dMRSIsInNldEF0dHJpYnV0ZSIsInRvZ2dsZU9mZiIsImN1cnJlbnRUYXJnZXQiLCJnZXRBdHRyaWJ1dGUiLCJ0b2dnbGVPZmZCdG4iLCJnZXRFbGVtZW50QnlJZCIsImNsaWNrIiwidG9nZ2xlIiwid2luZG93IiwiaW5uZXJXaWR0aCIsInByaW1hcnkiLCJvdmVybGF5IiwiaGVhZGVyIiwiY29udGFpbnMiLCJwSGVpZ2h0Iiwib2Zmc2V0SGVpZ2h0Iiwic3R5bGUiLCJoZWlnaHQiLCJib2R5IiwiYWRtaW5iYXIiLCJ0b3AiLCJkb2N1bWVudEVsZW1lbnQiLCJyZW1vdmUiLCJmb3JjZVRvZ2dsZSIsInRvZ2dsZUJ1dHRvbiIsInN1Yk1lbnUiLCJtYWluUGFyZW50TWVudSIsImNsb3Nlc3QiLCJwYXJlbnRNZW51SXRlbVRvZ2dsZWQiLCJ1bmRlZmluZWQiLCJ0b1N0cmluZyIsIndwUmlnU2NyZWVuUmVhZGVyVGV4dCIsImV4cGFuZCIsInN1Yk1lbnVJdGVtc1RvZ2dsZWQiLCJjb2xsYXBzZSIsImNvbnRhaW5lciIsImVsZW1lbnQiLCJmb2N1c2FibGVFbGVtZW50cyIsImVsIiwic2VsIiwicGFyZW50RWxlbWVudCIsIm1hdGNoZXMiLCJtYXRjaGVzU2VsZWN0b3IiLCJjYWxsIiwicmVtb3ZlUHJvcGVydHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7Ozs7OztBQU9BLElBQU1BLE1BQU0sR0FBRztBQUNkQyxFQUFBQSxHQUFHLEVBQUU7QUFEUyxDQUFmOztBQUlBLElBQUssY0FBY0MsUUFBUSxDQUFDQyxVQUE1QixFQUF5QztBQUN4QztBQUNBRCxFQUFBQSxRQUFRLENBQUNFLGdCQUFULENBQTJCLGtCQUEzQixFQUErQ0MsY0FBL0M7QUFDQSxDQUhELE1BR087QUFDTjtBQUNBQSxFQUFBQSxjQUFjO0FBQ2QsQyxDQUVEOzs7QUFDQSxTQUFTQSxjQUFULEdBQTBCO0FBQ3pCQyxFQUFBQSxxQkFBcUI7QUFDckJDLEVBQUFBLGtCQUFrQjtBQUNsQjtBQUVEOzs7Ozs7QUFJQSxTQUFTRCxxQkFBVCxHQUFpQztBQUNoQyxNQUFNRSxTQUFTLEdBQUdOLFFBQVEsQ0FBQ08sZ0JBQVQsQ0FBMkIsa0JBQTNCLENBQWxCLENBRGdDLENBR2hDOztBQUNBLE1BQUssQ0FBRUQsU0FBUyxDQUFDRSxNQUFqQixFQUEwQjtBQUN6QjtBQUNBOztBQUVELE9BQU0sSUFBSUMsQ0FBQyxHQUFHLENBQWQsRUFBaUJBLENBQUMsR0FBR0gs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Q0FBQ3hFLGdCQUFWLENBQTRCNkIsYUFBNUIsQ0FBMUI7O0FBQ0EsTUFBSyxJQUFJNkMsaUJBQWlCLENBQUN6RSxNQUEzQixFQUFvQztBQUNuQyxXQUFPd0UsT0FBTyxLQUFLQyxpQkFBaUIsQ0FBRUEsaUJBQWlCLENBQUN6RSxNQUFsQixHQUEyQixDQUE3QixDQUFwQztBQUNBOztBQUNELFNBQU8sS0FBUDtBQUNBO0FBRUQ7Ozs7Ozs7OztBQU9BLFNBQVN5QixZQUFULENBQXVCaUQsRUFBdkIsRUFBMkJDLEdBQTNCLEVBQWlDO0FBQ2hDLFNBQVEsQ0FBRUQsRUFBRSxHQUFHQSxFQUFFLENBQUNFLGFBQVYsS0FBNkIsQ0FBSSxDQUFFRixFQUFFLENBQUNHLE9BQUgsSUFBY0gsRUFBRSxDQUFDSSxlQUFuQixFQUFxQ0MsSUFBckMsQ0FBMkNMLEVBQTNDLEVBQStDQyxHQUEvQyxDQUF6QyxFQUFrRyxDQUVqRzs7QUFDRCxTQUFPRCxFQUFQO0FBQ0E7QUFFRDs7Ozs7QUFJQTlCLE1BQU0sQ0FBQ2xELGdCQUFQLENBQXlCLFFBQXpCLEVBQW1DLFlBQVc7QUFDN0MsTUFBTW9ELE9BQU8sR0FBR3RELFFBQVEsQ0FBQ2lELGNBQVQsQ0FBeUIsY0FBekIsQ0FBaEI7QUFDQUssRUFBQUEsT0FBTyxDQUFDbEMsU0FBUixDQUFrQjhDLE1BQWxCLENBQTBCLGNBQTFCO0FBQ0FaLEVBQUFBLE9BQU8sQ0FBQ00sS0FBUixDQUFjNEIsY0FBZCxDQUE4QixRQUE5QjtBQUNBLENBSkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgd3BSaWdTY3JlZW5SZWFkZXJUZXh0ICovXG4vKipcbiAqIEZpbGUgbmF2aWdhdGlvbi5qcy5cbiAqXG4gKiBIYW5kbGVzIHRvZ2dsaW5nIHRoZSBuYXZpZ2F0aW9uIG1lbnUgZm9yIHNtYWxsIHNjcmVlbnMgYW5kIGVuYWJsZXMgVEFCIGtleVxuICogbmF2aWdhdGlvbiBzdXBwb3J0IGZvciBkcm9wZG93biBtZW51cy5cbiAqL1xuXG5jb25zdCBLRVlNQVAgPSB7XG5cdFRBQjogOSxcbn07XG5cbmlmICggJ2xvYWRpbmcnID09PSBkb2N1bWVudC5yZWFkeVN0YXRlICkge1xuXHQvLyBUaGUgRE9NIGhhcyBub3QgeWV0IGJlZW4gbG9hZGVkLlxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnRE9NQ29udGVudExvYWRlZCcsIGluaXROYXZpZ2F0aW9uICk7XG59IGVsc2Uge1xuXHQvLyBUaGUgRE9NIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkLlxuXHRpbml0TmF2aWdhdGlvbigpO1xufVxuXG4vLyBJbml0aWF0ZSB0aGUgbWVudXMgd2hlbiB0aGUgRE9NIGxvYWRzLlxuZnVuY3Rpb24gaW5pdE5hdmlnYXRpb24oKSB7XG5cdGluaXROYXZUb2dnbGVTdWJtZW51cygpO1xuXHRpbml0TmF2VG9nZ2xlU21hbGwoKTtcbn1cblxuLyoqXG4gKiBJbml0aWF0ZSB0aGUgc2NyaXB0IHRvIHByb2Nlc3MgYWxsXG4gKiBuYXZpZ2F0aW9uIG1lbnVzIHdpdGggc3VibWVudSB0b2dnbGUgZW5hYmxlZC5cbiAqL1xuZnVuY3Rpb24gaW5pdE5hdlRvZ2dsZVN1Ym1lbnVzKCkge1xuXHRjb25zdCBuYXZUT0dHTEUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnLm5hdi0tdG9nZ2xlLXN1YicgKTtcblxuXHQvLyBObyBwb2ludCBpZiBubyBuYXZzLlxuXHRpZiAoICEgbmF2VE9HR0xFLmxlbmd0aCApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRmb3IgKCBsZXQgaSA9IDA7IGkgPCBuYXZUT0dHTEUubGVuZ3RoOyBpKysgKSB7XG5cdFx0aW5pdEVhY2hOYXZUb2dnbGVTdWJtZW51KCBuYXZUT0dHTEVbIGkgXSApO1xuXHR9XG59XG5cbi8qKlxuICogSW5pdGlhdGUgdGhlIHNjcmlwdCB0byBwcm9jZXNzIHN1Ym1lbnVcbiAqIG5hdmlnYXRpb24gdG9nZ2xlIGZvciBhIHNwZWNpZmljIG5hdmlnYXRpb24gbWVudS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBuYXYgTmF2aWdhdGlvbiBlbGVtZW50LlxuICovXG5mdW5jdGlvbiBpbml0RWFjaE5hdlRvZ2dsZVN1Ym1lbnUoIG5hdiApIHtcblx0Ly8gR2V0IHRoZSBzdWJtZW51cy5cblx0Y29uc3QgU1VCTUVOVVMgPSBuYXYucXVlcnlTZWxlY3RvckFsbCggJy5tZW51IHVsJyApO1xuXG5cdC8vIE5vIHBvaW50IGlmIG5vIHN1Ym1lbnVzLlxuXHRpZiAoICEgU1VCTUVOVVMubGVuZ3RoICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdC8vIENyZWF0ZSB0aGUgZHJvcGRvd24gYnV0dG9uLlxuXHRjb25zdCBkcm9wZG93bkJ1dHRvbiA9IGdldERyb3Bkb3duQnV0dG9uKCk7XG5cblx0Zm9yICggbGV0IGkgPSAwOyBpIDwgU1VCTUVOVVMubGVuZ3RoOyBpKysgKSB7XG5cdFx0Y29uc3QgcGFyZW50TWVudUl0ZW0gPSBTVUJNRU5VU1sgaSBdLnBhcmVudE5vZGU7XG5cdFx0bGV0IGRyb3Bkb3duID0gcGFyZW50TWVudUl0ZW0ucXVlcnlTZWxlY3RvciggJy5kcm9wZG93bicgKTtcblxuXHRcdC8vIElmIG5vIGRyb3Bkb3duLCBjcmVhdGUgb25lLlxuXHRcdGlmICggISBkcm9wZG93biApIHtcblx0XHRcdC8vIENyZWF0ZSBkcm9wZG93bi5cblx0XHRcdGRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7XG5cdFx0XHRkcm9wZG93bi5jbGFzc0xpc3QuYWRkKCAnZHJvcGRvd24nICk7XG5cblx0XHRcdGNvbnN0IGRyb3Bkb3duU3ltYm9sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2knICk7XG5cdFx0XHRkcm9wZG93blN5bWJvbC5jbGFzc0xpc3QuYWRkKCAnZHJvcGRvd24tc3ltYm9sJyApO1xuXHRcdFx0ZHJvcGRvd24uYXBwZW5kQ2hpbGQoIGRyb3Bkb3duU3ltYm9sICk7XG5cblx0XHRcdC8vIEFkZCBiZWZvcmUgc3VibWVudS5cblx0XHRcdFNVQk1FTlVTWyBpIF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGRyb3Bkb3duLCBTVUJNRU5VU1sgaSBdICk7XG5cdFx0fVxuXG5cdFx0Ly8gQ29udmVydCBkcm9wZG93biB0byBidXR0b24gbWFrZSBvbmUgZm9yIHBhcmVudCBpdGVtIGFuZCBvbmUgZm9yIGZpcnN0IGNoaWxkIGluIHN1Ym1lbnVcblx0XHRjb25zdCB0aGlzRHJvcGRvd25CdXR0b24gPSBkcm9wZG93bkJ1dHRvbi5jbG9uZU5vZGUoIHRydWUgKTtcblx0XHRjb25zdCBjaGlsZERyb3Bkb3duQnV0dG9uID0gZHJvcGRvd25CdXR0b24uY2xvbmVOb2RlKCB0cnVlICk7XG5cblx0XHQvLyBDb3B5IGNvbnRlbnRzIG9mIGRyb3Bkb3duIGludG8gYnV0dG9uLlxuXHRcdHRoaXNEcm9wZG93bkJ1dHRvbi5pbm5lckhUTUwgPSBkcm9wZG93bi5pbm5lckhUTUw7XG5cdFx0Y2hpbGREcm9wZG93bkJ1dHRvbi5pbm5lckhUTUwgPSBkcm9wZG93bi5pbm5lckhUTUw7XG5cblx0XHQvLyBSZXBsYWNlIGRyb3Bkb3duIHdpdGggdG9nZ2xlIGJ1dHRvbi5cblx0XHRkcm9wZG93bi5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCggdGhpc0Ryb3Bkb3duQnV0dG9uLCBkcm9wZG93biApO1xuXG5cdFx0Ly9maXJzdFN1Ykl0ZW0uYXBwZW5kQ2hpbGQoIGNoaWxkRHJvcGRvd25CdXR0b24gKTtcblxuXHRcdC8vIFRvZ2dsZSB0aGUgc3VibWVudSB3aGVuIHdlIGNsaWNrIHRoZSBkcm9wZG93biBidXR0b24uXG5cdFx0dGhpc0Ryb3Bkb3duQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsICggZSApID0+IHtcblx0XHRcdHRvZ2dsZVN1Yk1lbnUoIGUudGFyZ2V0LnBhcmVudE5vZGUgKTtcblx0XHR9ICk7XG5cblx0XHQvLyBUb2dnbGUgdGhlIHN1Ym1lbnUgd2hlbiB3ZSBjbGljayB0aGUgZHJvcGRvd24gYnV0dG9uLlxuXHRcdGNoaWxkRHJvcGRvd25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgKCBlICkgPT4ge1xuXHRcdFx0dG9nZ2xlU3ViTWVudSggZmluZEFuY2VzdG9yKCBlLnRhcmdldCwgJy5tZW51LWl0ZW0tLWhhcy10b2dnbGUnICkgKTtcblx0XHR9ICk7XG5cblx0XHQvLyAvLyBDbGVhbiB1cCB0aGUgdG9nZ2xlIGlmIGEgbW91c2UgdGFrZXMgb3ZlciBmcm9tIGtleWJvYXJkLlxuXHRcdC8vIHBhcmVudE1lbnVJdGVtLmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZWxlYXZlJywgKCBlICkgPT4ge1xuXHRcdC8vIFx0dG9nZ2xlU3ViTWVudSggZS50YXJnZXQsIGZhbHNlICk7XG5cdFx0Ly8gfSApO1xuXG5cdFx0Ly8gV2hlbiB3ZSBmb2N1cyBvbiBhIG1lbnUgbGluaywgbWFrZSBzdXJlIGFsbCBzaWJsaW5ncyBhcmUgY2xvc2VkLlxuXHRcdHBhcmVudE1lbnVJdGVtLnF1ZXJ5U2VsZWN0b3IoICdhJyApLmFkZEV2ZW50TGlzdGVuZXIoICdmb2N1cycsICggZSApID0+IHtcblx0XHRcdGNvbnN0IHBhcmVudE1lbnVJdGVtc1RvZ2dsZWQgPSBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvckFsbCggJ2xpLm1lbnUtaXRlbS0tdG9nZ2xlZC1vbicgKTtcblx0XHRcdGZvciAoIGxldCBqID0gMDsgaiA8IHBhcmVudE1lbnVJdGVtc1RvZ2dsZWQubGVuZ3RoOyBqKysgKSB7XG5cdFx0XHRcdHRvZ2dsZVN1Yk1lbnUoIHBhcmVudE1lbnVJdGVtc1RvZ2dsZWRbIGogXSwgZmFsc2UgKTtcblx0XHRcdH1cblx0XHR9ICk7XG5cblx0XHQvLyBIYW5kbGUga2V5Ym9hcmQgYWNjZXNzaWJpbGl0eSBmb3IgdHJhdmVyc2luZyBtZW51LlxuXHRcdFNVQk1FTlVTWyBpIF0uYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCAoIGUgKSA9PiB7XG5cdFx0XHQvLyBUaGVzZSBzcGVjaWZpYyBzZWxlY3RvcnMgaGVscCB1cyBvbmx5IHNlbGVjdCBpdGVtcyB0aGF0IGFyZSB2aXNpYmxlLlxuXHRcdFx0Y29uc3QgZm9jdXNTZWxlY3RvciA9ICd1bC50b2dnbGUtc2hvdyA+IGxpID4gYSwgdWwudG9nZ2xlLXNob3cgPiBsaSA+IGJ1dHRvbic7XG5cblx0XHRcdGlmICggS0VZTUFQLlRBQiA9PT0gZS5rZXlDb2RlICkge1xuXHRcdFx0XHRpZiAoIGUuc2hpZnRLZXkgKSB7XG5cdFx0XHRcdFx0Ly8gTWVhbnMgd2UncmUgdGFiYmluZyBvdXQgb2YgdGhlIGJlZ2lubmluZyBvZiB0aGUgc3VibWVudS5cblx0XHRcdFx0XHRpZiAoIGlzZmlyc3RGb2N1c2FibGVFbGVtZW50KCBlLnRhcmdldCwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgZm9jdXNTZWxlY3RvciApICkge1xuXHRcdFx0XHRcdFx0dG9nZ2xlU3ViTWVudSggZS50YXJnZXQucGFyZW50Tm9kZSwgZmFsc2UgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gTWVhbnMgd2UncmUgdGFiYmluZyBvdXQgb2YgdGhlIGVuZCBvZiB0aGUgc3VibWVudS5cblx0XHRcdFx0fSBlbHNlIGlmICggaXNsYXN0Rm9jdXNhYmxlRWxlbWVudCggZS50YXJnZXQsIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQsIGZvY3VzU2VsZWN0b3IgKSApIHtcblx0XHRcdFx0XHR0b2dnbGVTdWJNZW51KCBlLnRhcmdldC5wYXJlbnROb2RlLCBmYWxzZSApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSApO1xuXG5cdFx0U1VCTUVOVVNbIGkgXS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoICdtZW51LWl0ZW0tLWhhcy10b2dnbGUnICk7XG5cdH1cbn1cblxuLyoqXG4gKiBJbml0aWF0ZSB0aGUgc2NyaXB0IHRvIHByb2Nlc3MgYWxsXG4gKiBuYXZpZ2F0aW9uIG1lbnVzIHdpdGggc21hbGwgdG9nZ2xlIGVuYWJsZWQuXG4gKi9cbmZ1bmN0aW9uIGluaXROYXZUb2dnbGVTbWFsbCgpIHtcblx0Y29uc3QgbmF2VE9HR0xFID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggJy5uYXYtLXRvZ2dsZS1zbWFsbCcgKTtcblxuXHQvLyBObyBwb2ludCBpZiBubyBuYXZzLlxuXHRpZiAoICEgbmF2VE9HR0xFLmxlbmd0aCApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRmb3IgKCBsZXQgaSA9IDA7IGkgPCBuYXZUT0dHTEUubGVuZ3RoOyBpKysgKSB7XG5cdFx0aW5pdEVhY2hOYXZUb2dnbGVTbWFsbCggbmF2VE9HR0xFWyBpIF0gKTtcblx0fVxufVxuXG4vKipcbiAqIEluaXRpYXRlIHRoZSBzY3JpcHQgdG8gcHJvY2VzcyBzbWFsbFxuICogbmF2aWdhdGlvbiB0b2dnbGUgZm9yIGEgc3BlY2lmaWMgbmF2aWdhdGlvbiBtZW51LlxuICogQHBhcmFtIHtPYmplY3R9IG5hdiBOYXZpZ2F0aW9uIGVsZW1lbnQuXG4gKi9cbmZ1bmN0aW9uIGluaXRFYWNoTmF2VG9nZ2xlU21hbGwoIG5hdiApIHtcblx0Y29uc3QgbWVudVRPR0dMRSA9IG5hdi5xdWVyeVNlbGVjdG9yKCAnLmhlYWRlci10b2dnbGUnICk7XG5cblx0Ly8gUmV0dXJuIGVhcmx5IGlmIE1FTlVUT0dHTEUgaXMgbWlzc2luZy5cblx0aWYgKCAhIG1lbnVUT0dHTEUgKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Ly8gQWRkIGFuIGluaXRpYWwgdmFsdWVzIGZvciB0aGUgYXR0cmlidXRlLlxuXHRtZW51VE9HR0xFLnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cblx0bWVudVRPR0dMRS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCAoIGUgKSA9PiB7XG5cdFx0LyoqIFRvZ2dsZSBzZWFyY2ggLyBtZW51cyB3aGVuIG9uZSBpcyBvcGVuIGFuZCBjbGlja2luZyBvbiB0aGUgb3RoZXIgKi9cblx0XHRjb25zdCB0b2dnbGVPZmYgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCAnZGF0YS10b2dnbGVvZmYnICk7XG5cdFx0Y29uc3QgdG9nZ2xlT2ZmQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIHRvZ2dsZU9mZiApO1xuXHRcdGlmICggdG9nZ2xlT2ZmQnRuICYmICd0cnVlJyA9PT0gdG9nZ2xlT2ZmQnRuLmdldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnICkgKSB7XG5cdFx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggdG9nZ2xlT2ZmICkuY2xpY2soKTtcblx0XHR9XG5cblx0XHRuYXYuY2xhc3NMaXN0LnRvZ2dsZSggJ25hdi0tdG9nZ2xlZC1vbicgKTtcblxuXHRcdC8vc2V0IHRoZSBuYXYgaGVpZ2h0IHNvIGl0IGRvZXNudCBmbHVjdHVhdGUgd2hlbiB3ZSBzaG93IHRoZSBzdWItbWVudSBvbiBtb2JpbGVcblx0XHQvL3NldCB0aGUgdG9wIGFjY29yZGluZyB0byB0aGUgaGVhZGVyIGhlaWdodFxuXHRcdGlmICggd2luZG93LmlubmVyV2lkdGggPCAxMDI0ICkge1xuXHRcdFx0Y29uc3QgcHJpbWFyeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAncHJpbWFyeS1tZW51JyApO1xuXHRcdFx0Y29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnbmF2LW92ZXJsYXknICk7XG5cdFx0XHRjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ21hc3RoZWFkJyApO1xuXHRcdFx0aWYgKCAhIHByaW1hcnkuY2xhc3NMaXN0LmNvbnRhaW5zKCAnZml4ZWQtaGVpZ2h0JyApICkge1xuXHRcdFx0XHRjb25zdCBwSGVpZ2h0ID0gcHJpbWFyeS5vZmZzZXRIZWlnaHQ7XG5cdFx0XHRcdHByaW1hcnkuc3R5bGUuaGVpZ2h0ID0gcEhlaWdodCArICdweCc7XG5cdFx0XHRcdHByaW1hcnkuY2xhc3NMaXN0LmFkZCggJ2ZpeGVkLWhlaWdodCcgKTtcblx0XHRcdH1cblx0XHRcdGlmICggZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoICdhZG1pbi1iYXInICkgKSB7XG5cdFx0XHRcdGNvbnN0IGFkbWluYmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICd3cGFkbWluYmFyJyApO1xuXHRcdFx0XHRvdmVybGF5LnN0eWxlLnRvcCA9IGhlYWRlci5vZmZzZXRIZWlnaHQgKyBhZG1pbmJhci5vZmZzZXRIZWlnaHQgKyAncHgnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0b3ZlcmxheS5zdHlsZS50b3AgPSBoZWFkZXIub2Zmc2V0SGVpZ2h0ICsgJ3B4Jztcblx0XHRcdH1cblx0XHRcdHByaW1hcnkuc3R5bGUudG9wID0gaGVhZGVyLm9mZnNldEhlaWdodCArICdweCc7XG5cdFx0fVxuXG5cdFx0Ly9zaG91bGQgbm90IHNjcm9sbCB3aGVuICBuYXYgaXMgb3BlbiAobW9iaWxlIG9ubHkgYnV0IHRoYXQgaXMgaGFuZGxlZCB3aXRoIGNzcylcblx0XHRpZiAoIG5hdi5jbGFzc0xpc3QuY29udGFpbnMoICduYXYtLXRvZ2dsZWQtb24nICkgJiYgbmF2LmNsYXNzTGlzdC5jb250YWlucyggJ21haW4tbmF2aWdhdGlvbicgKSApIHtcblx0XHRcdC8vZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCAnb3ZlcmZsb3ctaGlkZGVuJyApO1xuXHRcdFx0ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoICdvdmVyZmxvdy1oaWRkZW4nICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCAnb3ZlcmZsb3ctaGlkZGVuJyApO1xuXHRcdFx0ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoICdvdmVyZmxvdy1oaWRkZW4nICk7XG5cdFx0fVxuXHRcdGUuY3VycmVudFRhcmdldC5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyA9PT0gZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnICkgPyAndHJ1ZScgOiAnZmFsc2UnICk7XG5cdH0sIGZhbHNlICk7XG59XG5cbi8qKlxuICogVG9nZ2xlIHN1Ym1lbnVzIG9wZW4gYW5kIGNsb3NlZCwgYW5kIHRlbGwgc2NyZWVuIHJlYWRlcnMgd2hhdCdzIGdvaW5nIG9uLlxuICogQHBhcmFtIHtPYmplY3R9IHBhcmVudE1lbnVJdGVtIFBhcmVudCBtZW51IGVsZW1lbnQuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGZvcmNlVG9nZ2xlIEZvcmNlIHRoZSBtZW51IHRvZ2dsZS5cbiAqIEByZXR1cm4ge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIHRvZ2dsZVN1Yk1lbnUoIHBhcmVudE1lbnVJdGVtLCBmb3JjZVRvZ2dsZSApIHtcblx0Y29uc3QgdG9nZ2xlQnV0dG9uID0gcGFyZW50TWVudUl0ZW0ucXVlcnlTZWxlY3RvciggJy5kcm9wZG93bi10b2dnbGUnICksXG5cdFx0c3ViTWVudSA9IHBhcmVudE1lbnVJdGVtLnF1ZXJ5U2VsZWN0b3IoICd1bCcgKSxcblx0XHRtYWluUGFyZW50TWVudSA9IHBhcmVudE1lbnVJdGVtLmNsb3Nlc3QoICcubmF2LS10b2dnbGUtc21hbGwnICk7XG5cdGxldCBwYXJlbnRNZW51SXRlbVRvZ2dsZWQgPSBwYXJlbnRNZW51SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoICdtZW51LWl0ZW0tLXRvZ2dsZWQtb24nICk7XG5cdC8vIFdpbGwgYmUgdHJ1ZSBpZiB3ZSB3YW50IHRvIGZvcmNlIHRoZSB0b2dnbGUgb24sIGZhbHNlIGlmIGZvcmNlIHRvZ2dsZSBjbG9zZS5cblx0aWYgKCB1bmRlZmluZWQgIT09IGZvcmNlVG9nZ2xlICYmICdib29sZWFuJyA9PT0gKCB0eXBlb2YgZm9yY2VUb2dnbGUgKSApIHtcblx0XHRwYXJlbnRNZW51SXRlbVRvZ2dsZWQgPSAhIGZvcmNlVG9nZ2xlO1xuXHR9XG5cblx0Ly8gVG9nZ2xlIGFyaWEtZXhwYW5kZWQgc3RhdHVzLlxuXHR0b2dnbGVCdXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1leHBhbmRlZCcsICggISBwYXJlbnRNZW51SXRlbVRvZ2dsZWQgKS50b1N0cmluZygpICk7XG5cblx0Lypcblx0ICogU3RlcHMgdG8gaGFuZGxlIGR1cmluZyB0b2dnbGU6XG5cdCAqIC0gTGV0IHRoZSBwYXJlbnQgbWVudSBpdGVtIGtub3cgd2UncmUgdG9nZ2xlZCBvbi9vZmYuXG5cdCAqIC0gVG9nZ2xlIHRoZSBBUklBIGxhYmVsIHRvIGxldCBzY3JlZW4gcmVhZGVycyBrbm93IHdpbGwgZXhwYW5kIG9yIGNvbGxhcHNlLlxuXHQgKi9cblx0aWYgKCBwYXJlbnRNZW51SXRlbVRvZ2dsZWQgKSB7XG5cdFx0Ly8gVG9nZ2xlIFwib2ZmXCIgdGhlIHN1Ym1lbnUuXG5cdFx0cGFyZW50TWVudUl0ZW0uY2xhc3NMaXN0LnJlbW92ZSggJ21lbnUtaXRlbS0tdG9nZ2xlZC1vbicgKTtcblx0XHRzdWJNZW51LmNsYXNzTGlzdC5yZW1vdmUoICd0b2dnbGUtc2hvdycgKTtcblx0XHR0b2dnbGVCdXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1sYWJlbCcsIHdwUmlnU2NyZWVuUmVhZGVyVGV4dC5leHBhbmQgKTtcblx0XHRtYWluUGFyZW50TWVudS5jbGFzc0xpc3QucmVtb3ZlKCAnc3VibmF2LS10b2dnbGVkLW9uJyApO1xuXG5cdFx0Ly8gTWFrZSBzdXJlIGFsbCBjaGlsZHJlbiBhcmUgY2xvc2VkLlxuXHRcdGNvbnN0IHN1Yk1lbnVJdGVtc1RvZ2dsZWQgPSBwYXJlbnRNZW51SXRlbS5xdWVyeVNlbGVjdG9yQWxsKCAnLm1lbnUtaXRlbS0tdG9nZ2xlZC1vbicgKTtcblx0XHRmb3IgKCBsZXQgaSA9IDA7IGkgPCBzdWJNZW51SXRlbXNUb2dnbGVkLmxlbmd0aDsgaSsrICkge1xuXHRcdFx0dG9nZ2xlU3ViTWVudSggc3ViTWVudUl0ZW1zVG9nZ2xlZFsgaSBdLCBmYWxzZSApO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQvLyBNYWtlIHN1cmUgc2libGluZ3MgYXJlIGNsb3NlZC5cblx0XHRjb25zdCBwYXJlbnRNZW51SXRlbXNUb2dnbGVkID0gcGFyZW50TWVudUl0ZW0ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCAnbGkubWVudS1pdGVtLS10b2dnbGVkLW9uJyApO1xuXHRcdGZvciAoIGxldCBpID0gMDsgaSA8IHBhcmVudE1lbnVJdGVtc1RvZ2dsZWQubGVuZ3RoOyBpKysgKSB7XG5cdFx0XHR0b2dnbGVTdWJNZW51KCBwYXJlbnRNZW51SXRlbXNUb2dnbGVkWyBpIF0sIGZhbHNlICk7XG5cdFx0fVxuXG5cdFx0Ly8gVG9nZ2xlIFwib25cIiB0aGUgc3VibWVudS5cblx0XHRwYXJlbnRNZW51SXRlbS5jbGFzc0xpc3QuYWRkKCAnbWVudS1pdGVtLS10b2dnbGVkLW9uJyApO1xuXHRcdG1haW5QYXJlbnRNZW51LmNsYXNzTGlzdC5hZGQoICdzdWJuYXYtLXRvZ2dsZWQtb24nICk7XG5cdFx0c3ViTWVudS5jbGFzc0xpc3QuYWRkKCAndG9nZ2xlLXNob3cnICk7XG5cdFx0dG9nZ2xlQnV0dG9uLnNldEF0dHJpYnV0ZSggJ2FyaWEtbGFiZWwnLCB3cFJpZ1NjcmVlblJlYWRlclRleHQuY29sbGFwc2UgKTtcblx0fVxufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGRyb3Bkb3duIGJ1dHRvblxuICogZWxlbWVudCBuZWVkZWQgZm9yIHRoZSBtZW51LlxuICogQHJldHVybiB7T2JqZWN0fSBkcm9wLWRvd24gYnV0dG9uIGVsZW1lbnRcbiAqL1xuZnVuY3Rpb24gZ2V0RHJvcGRvd25CdXR0b24oKSB7XG5cdGNvbnN0IGRyb3Bkb3duQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2J1dHRvbicgKTtcblx0ZHJvcGRvd25CdXR0b24uY2xhc3NMaXN0LmFkZCggJ2Ryb3Bkb3duLXRvZ2dsZScgKTtcblx0ZHJvcGRvd25CdXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1leHBhbmRlZCcsICdmYWxzZScgKTtcblx0ZHJvcGRvd25CdXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1sYWJlbCcsIHdwUmlnU2NyZWVuUmVhZGVyVGV4dC5leHBhbmQgKTtcblx0cmV0dXJuIGRyb3Bkb3duQnV0dG9uO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBlbGVtZW50IGlzIHRoZVxuICogZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQgaW4gdGhlIGNvbnRhaW5lci5cbiAqIEBwYXJhbSB7T2JqZWN0fSBjb250YWluZXJcbiAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZm9jdXNTZWxlY3RvclxuICogQHJldHVybiB7Ym9vbGVhbn0gd2hldGhlciBvciBub3QgdGhlIGVsZW1lbnQgaXMgdGhlIGZpcnN0IGZvY3VzYWJsZSBlbGVtZW50IGluIHRoZSBjb250YWluZXJcbiAqL1xuZnVuY3Rpb24gaXNmaXJzdEZvY3VzYWJsZUVsZW1lbnQoIGNvbnRhaW5lciwgZWxlbWVudCwgZm9jdXNTZWxlY3RvciApIHtcblx0Y29uc3QgZm9jdXNhYmxlRWxlbWVudHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCggZm9jdXNTZWxlY3RvciApO1xuXHRpZiAoIDAgPCBmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggKSB7XG5cdFx0cmV0dXJuIGVsZW1lbnQgPT09IGZvY3VzYWJsZUVsZW1lbnRzWyAwIF07XG5cdH1cblx0cmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBlbGVtZW50IGlzIHRoZVxuICogbGFzdCBmb2N1c2FibGUgZWxlbWVudCBpbiB0aGUgY29udGFpbmVyLlxuICogQHBhcmFtIHtPYmplY3R9IGNvbnRhaW5lclxuICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBmb2N1c1NlbGVjdG9yXG4gKiBAcmV0dXJuIHtib29sZWFufSB3aGV0aGVyIG9yIG5vdCB0aGUgZWxlbWVudCBpcyB0aGUgbGFzdCBmb2N1c2FibGUgZWxlbWVudCBpbiB0aGUgY29udGFpbmVyXG4gKi9cbmZ1bmN0aW9uIGlzbGFzdEZvY3VzYWJsZUVsZW1lbnQoIGNvbnRhaW5lciwgZWxlbWVudCwgZm9jdXNTZWxlY3RvciApIHtcblx0Y29uc3QgZm9jdXNhYmxlRWxlbWVudHMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCggZm9jdXNTZWxlY3RvciApO1xuXHRpZiAoIDAgPCBmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggKSB7XG5cdFx0cmV0dXJuIGVsZW1lbnQgPT09IGZvY3VzYWJsZUVsZW1lbnRzWyBmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLSAxIF07XG5cdH1cblx0cmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqICBSZXR1cm4gYW5jZXN0b3Igd2l0aCBjbGFzc1xuICogIEZvciBJRSAxMSAoZG9lcyBub3Qgc3VwcG9ydCBjbG9zZXN0IGQpXG4gKiBAcGFyYW0ge09iamVjdH0gZWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZWxcbiAqIEByZXR1cm4ge09iamVjdH0gbWF0Y2hpbmcgZWxlbWVudFxuICovXG5mdW5jdGlvbiBmaW5kQW5jZXN0b3IoIGVsLCBzZWwgKSB7XG5cdHdoaWxlICggKCBlbCA9IGVsLnBhcmVudEVsZW1lbnQgKSAmJiAhICggKCBlbC5tYXRjaGVzIHx8IGVsLm1hdGNoZXNTZWxlY3RvciApLmNhbGwoIGVsLCBzZWwgKSApICkge1xuXG5cdH1cblx0cmV0dXJuIGVsO1xufVxuXG4vKipcbiAqIFJlbW92ZSBoZWlnaHQgb24gbWVudSB3aGVuIHdpbmRvdyBzaXplIGNoYW5nZXNcbiAqL1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkge1xuXHRjb25zdCBwcmltYXJ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdwcmltYXJ5LW1lbnUnICk7XG5cdHByaW1hcnkuY2xhc3NMaXN0LnJlbW92ZSggJ2ZpeGVkLWhlaWdodCcgKTtcblx0cHJpbWFyeS5zdHlsZS5yZW1vdmVQcm9wZXJ0eSggJ2hlaWdodCcgKTtcbn0gKTtcbiJdLCJmaWxlIjoibmF2aWdhdGlvbi5taW4uanMifQ==