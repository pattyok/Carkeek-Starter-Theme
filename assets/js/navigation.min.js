"use strict";

/* global wpRigScreenReaderText */

/**
 * File navigation.js.
 *
 * Handles toggling the navigation menu for small screens and enables TAB key
 * navigation support for dropdown menus.
 */
var KEYMAP = {
  TAB: 9
};

if ('loading' === document.readyState) {
  // The DOM has not yet been loaded.
  document.addEventListener('DOMContentLoaded', initNavigation);
} else {
  // The DOM has already been loaded.
  initNavigation();
} // Initiate the menus when the DOM loads.


function initNavigation() {
  initNavToggleSubmenus();
  initNavToggleSmall();
}
/**
 * Initiate the script to process all
 * navigation menus with submenu toggle enabled.
 */


function initNavToggleSubmenus() {
  var navTOGGLE = document.querySelectorAll('.nav--toggle-sub'); // No point if no navs.

  if (!navTOGGLE.length) {
    return;
  }

  for (var i = 0; i < navTOGGLE.length; i++) {
    initEachNavToggleSubmenu(navTOGGLE[i]);
  }
}
/**
 * Initiate the script to process submenu
 * navigation toggle for a specific navigation menu.
 * @param {Object} nav Navigation element.
 */


function initEachNavToggleSubmenu(nav) {
  // Get the submenus.
  var SUBMENUS = nav.querySelectorAll('.menu ul'); // No point if no submenus.

  if (!SUBMENUS.length) {
    return;
  } // Create the dropdown button.


  var dropdownButton = getDropdownButton();

  for (var i = 0; i < SUBMENUS.length; i++) {
    var parentMenuItem = SUBMENUS[i].parentNode;
    var dropdown = parentMenuItem.querySelector('.dropdown'); // If no dropdown, create one.

    if (!dropdown) {
      // Create dropdown.
      dropdown = document.createElement('span');
      dropdown.classList.add('dropdown');
      var dropdownSymbol = document.createElement('i');
      dropdownSymbol.classList.add('dropdown-symbol');
      dropdown.appendChild(dropdownSymbol); // Add before submenu.

      SUBMENUS[i].parentNode.insertBefore(dropdown, SUBMENUS[i]);
    } // Convert dropdown to button.


    var thisDropdownButton = dropdownButton.cloneNode(true); // Copy contents of dropdown into button.

    thisDropdownButton.innerHTML = dropdown.innerHTML; // Replace dropdown with toggle button.

    dropdown.parentNode.replaceChild(thisDropdownButton, dropdown); // Toggle the submenu when we click the dropdown button.

    thisDropdownButton.addEventListener('click', function (e) {
      toggleSubMenu(e.target.parentNode);
    }); // Clean up the toggle if a mouse takes over from keyboard.

    parentMenuItem.addEventListener('mouseleave', function (e) {
      toggleSubMenu(e.target, false);
    }); // When we focus on a menu link, make sure all siblings are closed.

    parentMenuItem.querySelector('a').addEventListener('focus', function (e) {
      var parentMenuItemsToggled = e.target.parentNode.parentNode.querySelectorAll('li.menu-item--toggled-on');

      for (var j = 0; j < parentMenuItemsToggled.length; j++) {
        toggleSubMenu(parentMenuItemsToggled[j], false);
      }
    }); // Handle keyboard accessibility for traversing menu.

    SUBMENUS[i].addEventListener('keydown', function (e) {
      // These specific selectors help us only select items that are visible.
      var focusSelector = 'ul.toggle-show > li > a, ul.toggle-show > li > button';

      if (KEYMAP.TAB === e.keyCode) {
        if (e.shiftKey) {
          // Means we're tabbing out of the beginning of the submenu.
          if (isfirstFocusableElement(e.target, document.activeElement, focusSelector)) {
            toggleSubMenu(e.target.parentNode, false);
          } // Means we're tabbing out of the end of the submenu.

        } else if (islastFocusableElement(e.target, document.activeElement, focusSelector)) {
          toggleSubMenu(e.target.parentNode, false);
        }
      }
    });
    SUBMENUS[i].parentNode.classList.add('menu-item--has-toggle');
  }
}
/**
 * Initiate the script to process all
 * navigation menus with small toggle enabled.
 */


function initNavToggleSmall() {
  var navTOGGLE = document.querySelectorAll('.nav--toggle-small'); // No point if no navs.

  if (!navTOGGLE.length) {
    return;
  }

  for (var i = 0; i < navTOGGLE.length; i++) {
    initEachNavToggleSmall(navTOGGLE[i]);
  }
}
/**
 * Initiate the script to process small
 * navigation toggle for a specific navigation menu.
 * @param {Object} nav Navigation element.
 */


function initEachNavToggleSmall(nav) {
  var menuTOGGLE = nav.querySelector('.menu-toggle'); // Return early if MENUTOGGLE is missing.

  if (!menuTOGGLE) {
    return;
  } // Add an initial values for the attribute.


  menuTOGGLE.setAttribute('aria-expanded', 'false');
  menuTOGGLE.addEventListener('click', function () {
    nav.classList.toggle('nav--toggled-on');
    menuTOGGLE.setAttribute('aria-expanded', 'false' === menuTOGGLE.getAttribute('aria-expanded') ? 'true' : 'false');
  }, false);
}
/**
 * Toggle submenus open and closed, and tell screen readers what's going on.
 * @param {Object} parentMenuItem Parent menu element.
 * @param {boolean} forceToggle Force the menu toggle.
 * @return {void}
 */


function toggleSubMenu(parentMenuItem, forceToggle) {
  var toggleButton = parentMenuItem.querySelector('.dropdown-toggle'),
      subMenu = parentMenuItem.querySelector('ul');
  var parentMenuItemToggled = parentMenuItem.classList.contains('menu-item--toggled-on'); // Will be true if we want to force the toggle on, false if force toggle close.

  if (undefined !== forceToggle && 'boolean' === typeof forceToggle) {
    parentMenuItemToggled = !forceToggle;
  } // Toggle aria-expanded status.


  toggleButton.setAttribute('aria-expanded', (!parentMenuItemToggled).toString());
  /*
   * Steps to handle during toggle:
   * - Let the parent menu item know we're toggled on/off.
   * - Toggle the ARIA label to let screen readers know will expand or collapse.
   */

  if (parentMenuItemToggled) {
    // Toggle "off" the submenu.
    parentMenuItem.classList.remove('menu-item--toggled-on');
    subMenu.classList.remove('toggle-show');
    toggleButton.setAttribute('aria-label', wpRigScreenReaderText.expand); // Make sure all children are closed.

    var subMenuItemsToggled = parentMenuItem.querySelectorAll('.menu-item--toggled-on');

    for (var i = 0; i < subMenuItemsToggled.length; i++) {
      toggleSubMenu(subMenuItemsToggled[i], false);
    }
  } else {
    // Make sure siblings are closed.
    var parentMenuItemsToggled = parentMenuItem.parentNode.querySelectorAll('li.menu-item--toggled-on');

    for (var _i = 0; _i < parentMenuItemsToggled.length; _i++) {
      toggleSubMenu(parentMenuItemsToggled[_i], false);
    } // Toggle "on" the submenu.


    parentMenuItem.classList.add('menu-item--toggled-on');
    subMenu.classList.add('toggle-show');
    toggleButton.setAttribute('aria-label', wpRigScreenReaderText.collapse);
  }
}
/**
 * Returns the dropdown button
 * element needed for the menu.
 * @return {Object} drop-down button element
 */


function getDropdownButton() {
  var dropdownButton = document.createElement('button');
  dropdownButton.classList.add('dropdown-toggle');
  dropdownButton.setAttribute('aria-expanded', 'false');
  dropdownButton.setAttribute('aria-label', wpRigScreenReaderText.expand);
  return dropdownButton;
}
/**
 * Returns true if element is the
 * first focusable element in the container.
 * @param {Object} container
 * @param {Object} element
 * @param {string} focusSelector
 * @return {boolean} whether or not the element is the first focusable element in the container
 */


function isfirstFocusableElement(container, element, focusSelector) {
  var focusableElements = container.querySelectorAll(focusSelector);

  if (0 < focusableElements.length) {
    return element === focusableElements[0];
  }

  return false;
}
/**
 * Returns true if element is the
 * last focusable element in the container.
 * @param {Object} container
 * @param {Object} element
 * @param {string} focusSelector
 * @return {boolean} whether or not the element is the last focusable element in the container
 */


function islastFocusableElement(container, element, focusSelector) {
  var focusableElements = container.querySelectorAll(focusSelector);

  if (0 < focusableElements.length) {
    return element === focusableElements[focusableElements.length - 1];
  }

  return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5hdmlnYXRpb24uanMiXSwibmFtZXMiOlsiS0VZTUFQIiwiVEFCIiwiZG9jdW1lbnQiLCJyZWFkeVN0YXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImluaXROYXZpZ2F0aW9uIiwiaW5pdE5hdlRvZ2dsZVN1Ym1lbnVzIiwiaW5pdE5hdlRvZ2dsZVNtYWxsIiwibmF2VE9HR0xFIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImkiLCJpbml0RWFjaE5hdlRvZ2dsZVN1Ym1lbnUiLCJuYXYiLCJTVUJNRU5VUyIsImRyb3Bkb3duQnV0dG9uIiwiZ2V0RHJvcGRvd25CdXR0b24iLCJwYXJlbnRNZW51SXRlbSIsInBhcmVudE5vZGUiLCJkcm9wZG93biIsInF1ZXJ5U2VsZWN0b3IiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJvcGRvd25TeW1ib2wiLCJhcHBlbmRDaGlsZCIsImluc2VydEJlZm9yZSIsInRoaXNEcm9wZG93bkJ1dHRvbiIsImNsb25lTm9kZSIsImlubmVySFRNTCIsInJlcGxhY2VDaGlsZCIsImUiLCJ0b2dnbGVTdWJNZW51IiwidGFyZ2V0IiwicGFyZW50TWVudUl0ZW1zVG9nZ2xlZCIsImoiLCJmb2N1c1NlbGVjdG9yIiwia2V5Q29kZSIsInNoaWZ0S2V5IiwiaXNmaXJzdEZvY3VzYWJsZUVsZW1lbnQiLCJhY3RpdmVFbGVtZW50IiwiaXNsYXN0Rm9jdXNhYmxlRWxlbWVudCIsImluaXRFYWNoTmF2VG9nZ2xlU21hbGwiLCJtZW51VE9HR0xFIiwic2V0QXR0cmlidXRlIiwidG9nZ2xlIiwiZ2V0QXR0cmlidXRlIiwiZm9yY2VUb2dnbGUiLCJ0b2dnbGVCdXR0b24iLCJzdWJNZW51IiwicGFyZW50TWVudUl0ZW1Ub2dnbGVkIiwiY29udGFpbnMiLCJ1bmRlZmluZWQiLCJ0b1N0cmluZyIsInJlbW92ZSIsIndwUmlnU2NyZWVuUmVhZGVyVGV4dCIsImV4cGFuZCIsInN1Yk1lbnVJdGVtc1RvZ2dsZWQiLCJjb2xsYXBz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QjtBQUNBUixFQUFBQSxjQUFjLENBQUM2QixZQUFmLENBQTZCLGVBQTdCLEVBQThDLE9BQTlDO0FBQ0E3QixFQUFBQSxjQUFjLENBQUM2QixZQUFmLENBQTZCLFlBQTdCLEVBQTJDVyxxQkFBcUIsQ0FBQ0MsTUFBakU7QUFDQSxTQUFPekMsY0FBUDtBQUNBO0FBRUQ7Ozs7Ozs7Ozs7QUFRQSxTQUFTd0IsdUJBQVQsQ0FBa0NvQixTQUFsQyxFQUE2Q0MsT0FBN0MsRUFBc0R4QixhQUF0RCxFQUFzRTtBQUNyRSxNQUFNeUIsaUJBQWlCLEdBQUdGLFNBQVMsQ0FBQ2xELGdCQUFWLENBQTRCMkIsYUFBNUIsQ0FBMUI7O0FBQ0EsTUFBSyxJQUFJeUIsaUJBQWlCLENBQUNuRCxNQUEzQixFQUFvQztBQUNuQyxXQUFPa0QsT0FBTyxLQUFLQyxpQkFBaUIsQ0FBRSxDQUFGLENBQXBDO0FBQ0E7O0FBQ0QsU0FBTyxLQUFQO0FBQ0E7QUFFRDs7Ozs7Ozs7OztBQVFBLFNBQVNwQixzQkFBVCxDQUFpQ2tCLFNBQWpDLEVBQTRDQyxPQUE1QyxFQUFxRHhCLGFBQXJELEVBQXFFO0FBQ3BFLE1BQU15QixpQkFBaUIsR0FBR0YsU0FBUyxDQUFDbEQsZ0JBQVYsQ0FBNEIyQixhQUE1QixDQUExQjs7QUFDQSxNQUFLLElBQUl5QixpQkFBaUIsQ0FBQ25ELE1BQTNCLEVBQW9DO0FBQ25DLFdBQU9rRCxPQUFPLEtBQUtDLGlCQUFpQixDQUFFQSxpQkFBaUIsQ0FBQ25ELE1BQWxCLEdBQTJCLENBQTdCLENBQXBDO0FBQ0E7O0FBQ0QsU0FBTyxLQUFQO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgd3BSaWdTY3JlZW5SZWFkZXJUZXh0ICovXG4vKipcbiAqIEZpbGUgbmF2aWdhdGlvbi5qcy5cbiAqXG4gKiBIYW5kbGVzIHRvZ2dsaW5nIHRoZSBuYXZpZ2F0aW9uIG1lbnUgZm9yIHNtYWxsIHNjcmVlbnMgYW5kIGVuYWJsZXMgVEFCIGtleVxuICogbmF2aWdhdGlvbiBzdXBwb3J0IGZvciBkcm9wZG93biBtZW51cy5cbiAqL1xuXG5jb25zdCBLRVlNQVAgPSB7XG5cdFRBQjogOSxcbn07XG5cbmlmICggJ2xvYWRpbmcnID09PSBkb2N1bWVudC5yZWFkeVN0YXRlICkge1xuXHQvLyBUaGUgRE9NIGhhcyBub3QgeWV0IGJlZW4gbG9hZGVkLlxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnRE9NQ29udGVudExvYWRlZCcsIGluaXROYXZpZ2F0aW9uICk7XG59IGVsc2Uge1xuXHQvLyBUaGUgRE9NIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkLlxuXHRpbml0TmF2aWdhdGlvbigpO1xufVxuXG4vLyBJbml0aWF0ZSB0aGUgbWVudXMgd2hlbiB0aGUgRE9NIGxvYWRzLlxuZnVuY3Rpb24gaW5pdE5hdmlnYXRpb24oKSB7XG5cdGluaXROYXZUb2dnbGVTdWJtZW51cygpO1xuXHRpbml0TmF2VG9nZ2xlU21hbGwoKTtcbn1cblxuLyoqXG4gKiBJbml0aWF0ZSB0aGUgc2NyaXB0IHRvIHByb2Nlc3MgYWxsXG4gKiBuYXZpZ2F0aW9uIG1lbnVzIHdpdGggc3VibWVudSB0b2dnbGUgZW5hYmxlZC5cbiAqL1xuZnVuY3Rpb24gaW5pdE5hdlRvZ2dsZVN1Ym1lbnVzKCkge1xuXHRjb25zdCBuYXZUT0dHTEUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnLm5hdi0tdG9nZ2xlLXN1YicgKTtcblxuXHQvLyBObyBwb2ludCBpZiBubyBuYXZzLlxuXHRpZiAoICEgbmF2VE9HR0xFLmxlbmd0aCApIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRmb3IgKCBsZXQgaSA9IDA7IGkgPCBuYXZUT0dHTEUubGVuZ3RoOyBpKysgKSB7XG5cdFx0aW5pdEVhY2hOYXZUb2dnbGVTdWJtZW51KCBuYXZUT0dHTEVbIGkgXSApO1xuXHR9XG59XG5cbi8qKlxuICogSW5pdGlhdGUgdGhlIHNjcmlwdCB0byBwcm9jZXNzIHN1Ym1lbnVcbiAqIG5hdmlnYXRpb24gdG9nZ2xlIGZvciBhIHNwZWNpZmljIG5hdmlnYXRpb24gbWVudS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBuYXYgTmF2aWdhdGlvbiBlbGVtZW50LlxuICovXG5mdW5jdGlvbiBpbml0RWFjaE5hdlRvZ2dsZVN1Ym1lbnUoIG5hdiApIHtcblx0Ly8gR2V0IHRoZSBzdWJtZW51cy5cblx0Y29uc3QgU1VCTUVOVVMgPSBuYXYucXVlcnlTZWxlY3RvckFsbCggJy5tZW51IHVsJyApO1xuXG5cdC8vIE5vIHBvaW50IGlmIG5vIHN1Ym1lbnVzLlxuXHRpZiAoICEgU1VCTUVOVVMubGVuZ3RoICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdC8vIENyZWF0ZSB0aGUgZHJvcGRvd24gYnV0dG9uLlxuXHRjb25zdCBkcm9wZG93bkJ1dHRvbiA9IGdldERyb3Bkb3duQnV0dG9uKCk7XG5cblx0Zm9yICggbGV0IGkgPSAwOyBpIDwgU1VCTUVOVVMubGVuZ3RoOyBpKysgKSB7XG5cdFx0Y29uc3QgcGFyZW50TWVudUl0ZW0gPSBTVUJNRU5VU1sgaSBdLnBhcmVudE5vZGU7XG5cdFx0bGV0IGRyb3Bkb3duID0gcGFyZW50TWVudUl0ZW0ucXVlcnlTZWxlY3RvciggJy5kcm9wZG93bicgKTtcblxuXHRcdC8vIElmIG5vIGRyb3Bkb3duLCBjcmVhdGUgb25lLlxuXHRcdGlmICggISBkcm9wZG93biApIHtcblx0XHRcdC8vIENyZWF0ZSBkcm9wZG93bi5cblx0XHRcdGRyb3Bkb3duID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7XG5cdFx0XHRkcm9wZG93bi5jbGFzc0xpc3QuYWRkKCAnZHJvcGRvd24nICk7XG5cblx0XHRcdGNvbnN0IGRyb3Bkb3duU3ltYm9sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2knICk7XG5cdFx0XHRkcm9wZG93blN5bWJvbC5jbGFzc0xpc3QuYWRkKCAnZHJvcGRvd24tc3ltYm9sJyApO1xuXHRcdFx0ZHJvcGRvd24uYXBwZW5kQ2hpbGQoIGRyb3Bkb3duU3ltYm9sICk7XG5cblx0XHRcdC8vIEFkZCBiZWZvcmUgc3VibWVudS5cblx0XHRcdFNVQk1FTlVTWyBpIF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGRyb3Bkb3duLCBTVUJNRU5VU1sgaSBdICk7XG5cdFx0fVxuXG5cdFx0Ly8gQ29udmVydCBkcm9wZG93biB0byBidXR0b24uXG5cdFx0Y29uc3QgdGhpc0Ryb3Bkb3duQnV0dG9uID0gZHJvcGRvd25CdXR0b24uY2xvbmVOb2RlKCB0cnVlICk7XG5cblx0XHQvLyBDb3B5IGNvbnRlbnRzIG9mIGRyb3Bkb3duIGludG8gYnV0dG9uLlxuXHRcdHRoaXNEcm9wZG93bkJ1dHRvbi5pbm5lckhUTUwgPSBkcm9wZG93bi5pbm5lckhUTUw7XG5cblx0XHQvLyBSZXBsYWNlIGRyb3Bkb3duIHdpdGggdG9nZ2xlIGJ1dHRvbi5cblx0XHRkcm9wZG93bi5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCggdGhpc0Ryb3Bkb3duQnV0dG9uLCBkcm9wZG93biApO1xuXG5cdFx0Ly8gVG9nZ2xlIHRoZSBzdWJtZW51IHdoZW4gd2UgY2xpY2sgdGhlIGRyb3Bkb3duIGJ1dHRvbi5cblx0XHR0aGlzRHJvcGRvd25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgKCBlICkgPT4ge1xuXHRcdFx0dG9nZ2xlU3ViTWVudSggZS50YXJnZXQucGFyZW50Tm9kZSApO1xuXHRcdH0gKTtcblxuXHRcdC8vIENsZWFuIHVwIHRoZSB0b2dnbGUgaWYgYSBtb3VzZSB0YWtlcyBvdmVyIGZyb20ga2V5Ym9hcmQuXG5cdFx0cGFyZW50TWVudUl0ZW0uYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlbGVhdmUnLCAoIGUgKSA9PiB7XG5cdFx0XHR0b2dnbGVTdWJNZW51KCBlLnRhcmdldCwgZmFsc2UgKTtcblx0XHR9ICk7XG5cblx0XHQvLyBXaGVuIHdlIGZvY3VzIG9uIGEgbWVudSBsaW5rLCBtYWtlIHN1cmUgYWxsIHNpYmxpbmdzIGFyZSBjbG9zZWQuXG5cdFx0cGFyZW50TWVudUl0ZW0ucXVlcnlTZWxlY3RvciggJ2EnICkuYWRkRXZlbnRMaXN0ZW5lciggJ2ZvY3VzJywgKCBlICkgPT4ge1xuXHRcdFx0Y29uc3QgcGFyZW50TWVudUl0ZW1zVG9nZ2xlZCA9IGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCAnbGkubWVudS1pdGVtLS10b2dnbGVkLW9uJyApO1xuXHRcdFx0Zm9yICggbGV0IGogPSAwOyBqIDwgcGFyZW50TWVudUl0ZW1zVG9nZ2xlZC5sZW5ndGg7IGorKyApIHtcblx0XHRcdFx0dG9nZ2xlU3ViTWVudSggcGFyZW50TWVudUl0ZW1zVG9nZ2xlZFsgaiBdLCBmYWxzZSApO1xuXHRcdFx0fVxuXHRcdH0gKTtcblxuXHRcdC8vIEhhbmRsZSBrZXlib2FyZCBhY2Nlc3NpYmlsaXR5IGZvciB0cmF2ZXJzaW5nIG1lbnUuXG5cdFx0U1VCTUVOVVNbIGkgXS5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsICggZSApID0+IHtcblx0XHRcdC8vIFRoZXNlIHNwZWNpZmljIHNlbGVjdG9ycyBoZWxwIHVzIG9ubHkgc2VsZWN0IGl0ZW1zIHRoYXQgYXJlIHZpc2libGUuXG5cdFx0XHRjb25zdCBmb2N1c1NlbGVjdG9yID0gJ3VsLnRvZ2dsZS1zaG93ID4gbGkgPiBhLCB1bC50b2dnbGUtc2hvdyA+IGxpID4gYnV0dG9uJztcblxuXHRcdFx0aWYgKCBLRVlNQVAuVEFCID09PSBlLmtleUNvZGUgKSB7XG5cdFx0XHRcdGlmICggZS5zaGlmdEtleSApIHtcblx0XHRcdFx0XHQvLyBNZWFucyB3ZSdyZSB0YWJiaW5nIG91dCBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzdWJtZW51LlxuXHRcdFx0XHRcdGlmICggaXNmaXJzdEZvY3VzYWJsZUVsZW1lbnQoIGUudGFyZ2V0LCBkb2N1bWVudC5hY3RpdmVFbGVtZW50LCBmb2N1c1NlbGVjdG9yICkgKSB7XG5cdFx0XHRcdFx0XHR0b2dnbGVTdWJNZW51KCBlLnRhcmdldC5wYXJlbnROb2RlLCBmYWxzZSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQvLyBNZWFucyB3ZSdyZSB0YWJiaW5nIG91dCBvZiB0aGUgZW5kIG9mIHRoZSBzdWJtZW51LlxuXHRcdFx0XHR9IGVsc2UgaWYgKCBpc2xhc3RGb2N1c2FibGVFbGVtZW50KCBlLnRhcmdldCwgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCwgZm9jdXNTZWxlY3RvciApICkge1xuXHRcdFx0XHRcdHRvZ2dsZVN1Yk1lbnUoIGUudGFyZ2V0LnBhcmVudE5vZGUsIGZhbHNlICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ICk7XG5cblx0XHRTVUJNRU5VU1sgaSBdLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCggJ21lbnUtaXRlbS0taGFzLXRvZ2dsZScgKTtcblx0fVxufVxuXG4vKipcbiAqIEluaXRpYXRlIHRoZSBzY3JpcHQgdG8gcHJvY2VzcyBhbGxcbiAqIG5hdmlnYXRpb24gbWVudXMgd2l0aCBzbWFsbCB0b2dnbGUgZW5hYmxlZC5cbiAqL1xuZnVuY3Rpb24gaW5pdE5hdlRvZ2dsZVNtYWxsKCkge1xuXHRjb25zdCBuYXZUT0dHTEUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnLm5hdi0tdG9nZ2xlLXNtYWxsJyApO1xuXG5cdC8vIE5vIHBvaW50IGlmIG5vIG5hdnMuXG5cdGlmICggISBuYXZUT0dHTEUubGVuZ3RoICkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGZvciAoIGxldCBpID0gMDsgaSA8IG5hdlRPR0dMRS5sZW5ndGg7IGkrKyApIHtcblx0XHRpbml0RWFjaE5hdlRvZ2dsZVNtYWxsKCBuYXZUT0dHTEVbIGkgXSApO1xuXHR9XG59XG5cbi8qKlxuICogSW5pdGlhdGUgdGhlIHNjcmlwdCB0byBwcm9jZXNzIHNtYWxsXG4gKiBuYXZpZ2F0aW9uIHRvZ2dsZSBmb3IgYSBzcGVjaWZpYyBuYXZpZ2F0aW9uIG1lbnUuXG4gKiBAcGFyYW0ge09iamVjdH0gbmF2IE5hdmlnYXRpb24gZWxlbWVudC5cbiAqL1xuZnVuY3Rpb24gaW5pdEVhY2hOYXZUb2dnbGVTbWFsbCggbmF2ICkge1xuXHRjb25zdCBtZW51VE9HR0xFID0gbmF2LnF1ZXJ5U2VsZWN0b3IoICcubWVudS10b2dnbGUnICk7XG5cblx0Ly8gUmV0dXJuIGVhcmx5IGlmIE1FTlVUT0dHTEUgaXMgbWlzc2luZy5cblx0aWYgKCAhIG1lbnVUT0dHTEUgKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Ly8gQWRkIGFuIGluaXRpYWwgdmFsdWVzIGZvciB0aGUgYXR0cmlidXRlLlxuXHRtZW51VE9HR0xFLnNldEF0dHJpYnV0ZSggJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnICk7XG5cblx0bWVudVRPR0dMRS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCAoICkgPT4ge1xuXHRcdG5hdi5jbGFzc0xpc3QudG9nZ2xlKCAnbmF2LS10b2dnbGVkLW9uJyApO1xuXHRcdG1lbnVUT0dHTEUuc2V0QXR0cmlidXRlKCAnYXJpYS1leHBhbmRlZCcsICdmYWxzZScgPT09IG1lbnVUT0dHTEUuZ2V0QXR0cmlidXRlKCAnYXJpYS1leHBhbmRlZCcgKSA/ICd0cnVlJyA6ICdmYWxzZScgKTtcblx0fSwgZmFsc2UgKTtcbn1cblxuLyoqXG4gKiBUb2dnbGUgc3VibWVudXMgb3BlbiBhbmQgY2xvc2VkLCBhbmQgdGVsbCBzY3JlZW4gcmVhZGVycyB3aGF0J3MgZ29pbmcgb24uXG4gKiBAcGFyYW0ge09iamVjdH0gcGFyZW50TWVudUl0ZW0gUGFyZW50IG1lbnUgZWxlbWVudC5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gZm9yY2VUb2dnbGUgRm9yY2UgdGhlIG1lbnUgdG9nZ2xlLlxuICogQHJldHVybiB7dm9pZH1cbiAqL1xuZnVuY3Rpb24gdG9nZ2xlU3ViTWVudSggcGFyZW50TWVudUl0ZW0sIGZvcmNlVG9nZ2xlICkge1xuXHRjb25zdCB0b2dnbGVCdXR0b24gPSBwYXJlbnRNZW51SXRlbS5xdWVyeVNlbGVjdG9yKCAnLmRyb3Bkb3duLXRvZ2dsZScgKSxcblx0XHRzdWJNZW51ID0gcGFyZW50TWVudUl0ZW0ucXVlcnlTZWxlY3RvciggJ3VsJyApO1xuXG5cdGxldCBwYXJlbnRNZW51SXRlbVRvZ2dsZWQgPSBwYXJlbnRNZW51SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoICdtZW51LWl0ZW0tLXRvZ2dsZWQtb24nICk7XG5cblx0Ly8gV2lsbCBiZSB0cnVlIGlmIHdlIHdhbnQgdG8gZm9yY2UgdGhlIHRvZ2dsZSBvbiwgZmFsc2UgaWYgZm9yY2UgdG9nZ2xlIGNsb3NlLlxuXHRpZiAoIHVuZGVmaW5lZCAhPT0gZm9yY2VUb2dnbGUgJiYgJ2Jvb2xlYW4nID09PSAoIHR5cGVvZiBmb3JjZVRvZ2dsZSApICkge1xuXHRcdHBhcmVudE1lbnVJdGVtVG9nZ2xlZCA9ICEgZm9yY2VUb2dnbGU7XG5cdH1cblxuXHQvLyBUb2dnbGUgYXJpYS1leHBhbmRlZCBzdGF0dXMuXG5cdHRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgKCAhIHBhcmVudE1lbnVJdGVtVG9nZ2xlZCApLnRvU3RyaW5nKCkgKTtcblxuXHQvKlxuXHQgKiBTdGVwcyB0byBoYW5kbGUgZHVyaW5nIHRvZ2dsZTpcblx0ICogLSBMZXQgdGhlIHBhcmVudCBtZW51IGl0ZW0ga25vdyB3ZSdyZSB0b2dnbGVkIG9uL29mZi5cblx0ICogLSBUb2dnbGUgdGhlIEFSSUEgbGFiZWwgdG8gbGV0IHNjcmVlbiByZWFkZXJzIGtub3cgd2lsbCBleHBhbmQgb3IgY29sbGFwc2UuXG5cdCAqL1xuXHRpZiAoIHBhcmVudE1lbnVJdGVtVG9nZ2xlZCApIHtcblx0XHQvLyBUb2dnbGUgXCJvZmZcIiB0aGUgc3VibWVudS5cblx0XHRwYXJlbnRNZW51SXRlbS5jbGFzc0xpc3QucmVtb3ZlKCAnbWVudS1pdGVtLS10b2dnbGVkLW9uJyApO1xuXHRcdHN1Yk1lbnUuY2xhc3NMaXN0LnJlbW92ZSggJ3RvZ2dsZS1zaG93JyApO1xuXHRcdHRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWxhYmVsJywgd3BSaWdTY3JlZW5SZWFkZXJUZXh0LmV4cGFuZCApO1xuXG5cdFx0Ly8gTWFrZSBzdXJlIGFsbCBjaGlsZHJlbiBhcmUgY2xvc2VkLlxuXHRcdGNvbnN0IHN1Yk1lbnVJdGVtc1RvZ2dsZWQgPSBwYXJlbnRNZW51SXRlbS5xdWVyeVNlbGVjdG9yQWxsKCAnLm1lbnUtaXRlbS0tdG9nZ2xlZC1vbicgKTtcblx0XHRmb3IgKCBsZXQgaSA9IDA7IGkgPCBzdWJNZW51SXRlbXNUb2dnbGVkLmxlbmd0aDsgaSsrICkge1xuXHRcdFx0dG9nZ2xlU3ViTWVudSggc3ViTWVudUl0ZW1zVG9nZ2xlZFsgaSBdLCBmYWxzZSApO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHQvLyBNYWtlIHN1cmUgc2libGluZ3MgYXJlIGNsb3NlZC5cblx0XHRjb25zdCBwYXJlbnRNZW51SXRlbXNUb2dnbGVkID0gcGFyZW50TWVudUl0ZW0ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCAnbGkubWVudS1pdGVtLS10b2dnbGVkLW9uJyApO1xuXHRcdGZvciAoIGxldCBpID0gMDsgaSA8IHBhcmVudE1lbnVJdGVtc1RvZ2dsZWQubGVuZ3RoOyBpKysgKSB7XG5cdFx0XHR0b2dnbGVTdWJNZW51KCBwYXJlbnRNZW51SXRlbXNUb2dnbGVkWyBpIF0sIGZhbHNlICk7XG5cdFx0fVxuXHRcdC8vIFRvZ2dsZSBcIm9uXCIgdGhlIHN1Ym1lbnUuXG5cdFx0cGFyZW50TWVudUl0ZW0uY2xhc3NMaXN0LmFkZCggJ21lbnUtaXRlbS0tdG9nZ2xlZC1vbicgKTtcblx0XHRzdWJNZW51LmNsYXNzTGlzdC5hZGQoICd0b2dnbGUtc2hvdycgKTtcblx0XHR0b2dnbGVCdXR0b24uc2V0QXR0cmlidXRlKCAnYXJpYS1sYWJlbCcsIHdwUmlnU2NyZWVuUmVhZGVyVGV4dC5jb2xsYXBzZSApO1xuXHR9XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgZHJvcGRvd24gYnV0dG9uXG4gKiBlbGVtZW50IG5lZWRlZCBmb3IgdGhlIG1lbnUuXG4gKiBAcmV0dXJuIHtPYmplY3R9IGRyb3AtZG93biBidXR0b24gZWxlbWVudFxuICovXG5mdW5jdGlvbiBnZXREcm9wZG93bkJ1dHRvbigpIHtcblx0Y29uc3QgZHJvcGRvd25CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnYnV0dG9uJyApO1xuXHRkcm9wZG93bkJ1dHRvbi5jbGFzc0xpc3QuYWRkKCAnZHJvcGRvd24tdG9nZ2xlJyApO1xuXHRkcm9wZG93bkJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyApO1xuXHRkcm9wZG93bkJ1dHRvbi5zZXRBdHRyaWJ1dGUoICdhcmlhLWxhYmVsJywgd3BSaWdTY3JlZW5SZWFkZXJUZXh0LmV4cGFuZCApO1xuXHRyZXR1cm4gZHJvcGRvd25CdXR0b247XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGVsZW1lbnQgaXMgdGhlXG4gKiBmaXJzdCBmb2N1c2FibGUgZWxlbWVudCBpbiB0aGUgY29udGFpbmVyLlxuICogQHBhcmFtIHtPYmplY3R9IGNvbnRhaW5lclxuICogQHBhcmFtIHtPYmplY3R9IGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBmb2N1c1NlbGVjdG9yXG4gKiBAcmV0dXJuIHtib29sZWFufSB3aGV0aGVyIG9yIG5vdCB0aGUgZWxlbWVudCBpcyB0aGUgZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQgaW4gdGhlIGNvbnRhaW5lclxuICovXG5mdW5jdGlvbiBpc2ZpcnN0Rm9jdXNhYmxlRWxlbWVudCggY29udGFpbmVyLCBlbGVtZW50LCBmb2N1c1NlbGVjdG9yICkge1xuXHRjb25zdCBmb2N1c2FibGVFbGVtZW50cyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCBmb2N1c1NlbGVjdG9yICk7XG5cdGlmICggMCA8IGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCApIHtcblx0XHRyZXR1cm4gZWxlbWVudCA9PT0gZm9jdXNhYmxlRWxlbWVudHNbIDAgXTtcblx0fVxuXHRyZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGVsZW1lbnQgaXMgdGhlXG4gKiBsYXN0IGZvY3VzYWJsZSBlbGVtZW50IGluIHRoZSBjb250YWluZXIuXG4gKiBAcGFyYW0ge09iamVjdH0gY29udGFpbmVyXG4gKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudFxuICogQHBhcmFtIHtzdHJpbmd9IGZvY3VzU2VsZWN0b3JcbiAqIEByZXR1cm4ge2Jvb2xlYW59IHdoZXRoZXIgb3Igbm90IHRoZSBlbGVtZW50IGlzIHRoZSBsYXN0IGZvY3VzYWJsZSBlbGVtZW50IGluIHRoZSBjb250YWluZXJcbiAqL1xuZnVuY3Rpb24gaXNsYXN0Rm9jdXNhYmxlRWxlbWVudCggY29udGFpbmVyLCBlbGVtZW50LCBmb2N1c1NlbGVjdG9yICkge1xuXHRjb25zdCBmb2N1c2FibGVFbGVtZW50cyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCBmb2N1c1NlbGVjdG9yICk7XG5cdGlmICggMCA8IGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCApIHtcblx0XHRyZXR1cm4gZWxlbWVudCA9PT0gZm9jdXNhYmxlRWxlbWVudHNbIGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAtIDEgXTtcblx0fVxuXHRyZXR1cm4gZmFsc2U7XG59XG4iXSwiZmlsZSI6Im5hdmlnYXRpb24ubWluLmpzIn0=